<script src="/js/codemirror.min.js" crossorigin="anonymous"></script>
<script src="/js/codemirror/javascript.min.js" crossorigin="anonymous"></script>
<script src="/js/codemirror/yaml.min.js" crossorigin="anonymous"></script>
<script src="/js/codemirror/properties.min.js" crossorigin="anonymous"></script>
<script src="/js/codemirror/addon/indent-fold.min.js" crossorigin="anonymous"></script>
<script src="/js/codemirror/addon/brace-fold.min.js" crossorigin="anonymous"></script>
<script src="/js/codemirror/addon/foldcode.min.js" crossorigin="anonymous"></script>
<script src="/js/codemirror/addon/foldgutter.min.js" crossorigin="anonymous"></script>
<link href="/css/foldgutter.min.css" rel="stylesheet" crossorigin="anonymous">

<style>
    .no-outline {
        outline: none;
    }

    .result-control {
        padding: .375rem .75rem;
        font-size: 1rem;
        line-height: 1.5;
        color: #212529;
        vertical-align: middle;
        background-color: white;
        border: 1px solid #ced4da;
        border: none;
        border-radius: .25rem;
        overflow-y: auto;
        height: 400px;
        word-wrap: break-word;
    }

</style>
<div class="container mt-5">
    <form id="form">
        <div class="row">
            <div class="col-lg-5 col-sm-12">
                <div class="card" style="min-height: 460px;max-height:460px">
                    <div class="card-header">
                        Text 1
                    </div>
                    <div class="card-body">
                        <textarea class="form-control no-outline" id="text1" name="text1" rows="30"></textarea>
                    </div>
                </div>
            </div>
            <div class="col-lg-5 col-sm-12">
                <div class="card" style="min-height: 460px;max-height:460px">
                    <div class="card-header">
                        Text 2
                    </div>
                    <div class="card-body">
                        <textarea class="form-control no-outline" id="text2" name="text2" rows="30"></textarea>
                    </div>
                </div>
            </div>
            <div class="col-lg-2 col-sm-12">
                <div class="row g-2">
                    <div class="col-12">
                        <button type="button" class="btn btn-primary btn-block"
                                onclick="compareTexts()">Compare</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-12">&nbsp;</div>
        </div>
        <div class="row">
            <div class="col-lg-10 col-sm-12">
                <div class="card" style="min-height: 460px;max-height:460px">
                    <div class="card-header">
                        Result
                    </div>
                    <div class="card-body">
                        <div class="form-control no-outline result-control" id="result" rows="30" ></div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<script>
    function compareTexts() {
        clearAlert();
        $.ajax({
            url: "/api/text",
            contentType: "application/json",
            dataType: "json",
            data: JSON.stringify({
                text1: document.text1.getValue(),
                text2: document.text2.getValue(),
            }),
            type: 'post', success: function (data) {
                if (!data.success) {
                    showAlert(data.message);
                    return;
                }
                document.getElementById('result').innerHTML = data.data.diffs;
            }, error: function (data) {
                showAlert('Failed to compare texts!');
            }
        });
    }

    $(document).ready(function () {
        var text1 = CodeMirror.fromTextArea(document.getElementById("text1"), {
            lineNumbers: true,
            gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
            foldGutter: true,
            lineWrapping: true
        });
        document.text1 = text1;

        var text2 = CodeMirror.fromTextArea(document.getElementById("text2"), {
            lineNumbers: true,
            gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
            foldGutter: true,
            lineWrapping: true
        });
        document.text2 = text2;
    });
</script>