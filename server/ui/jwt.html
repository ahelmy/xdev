<script src="/js/codemirror.min.js" crossorigin="anonymous"></script>
<script src="/js/codemirror/javascript.min.js" crossorigin="anonymous"></script>
{{template "ui/partials/navbar" .}}

<style>
    /* Add custom CSS to disable textarea highlighting */
    .no-outline {
        outline: none;
    }

    .CodeMirror {
        height: auto !important;
    }
</style>
<div class="container mt-5">
    <form id="form">
        {{.Error}}
        <div class="row">
            <div class="col-md-6 col-sm-12">
                <button type="button" style="width: 100%;" class="btn btn-primary btn-block" onclick="submitForm('decode')">Decode</button>
            </div>
            <div class="col-md-6 col-sm-12">
                <button type="button" style="width: 100%;" class="btn btn-primary btn-block" onclick="submitForm('encode')">Encode</button>
            </div>
        </div>
        <div class="row">
            <div class="col-12" style="height: 1px;"></div>
        </div>
        <div class="row">
            <div class="col-md-6 col-sm-12">
                <div class="card" style="height: 100%;">
                    <div class="card-header">
                        Encoded token
                    </div>
                    <div class="card-body">
                        <textarea class="form-control  no-outline" id="jwt" name="jwt" rows="30">{{.JWT}}</textarea>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-sm-12">
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                Header
                            </div>
                            <div class="card-body">
                                <textarea class="form-control  no-outline" id="header" name="header" rows="4">{{.Header}}</textarea>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                Payload
                            </div>
                            <div class="card-body">
                                <textarea class="form-control  no-outline" id="claims" name="claims" rows="15">{{.Claims}}</textarea>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                Secret
                            </div>
                            <div class="card-body">
                                <textarea class="form-control  no-outline" id="secret" name="secret" rows="4">{{.Secret}}</textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <input type="hidden" name="action" id="action" value="{{.action}}">
    </form>
</div>

<!-- Your custom script for copying text and showing tooltip -->
<script>
    function submitForm(action) {
        $("#action").val(action);
        $("#form").submit();
    }

    $(document).ready(function () {
        var jwt = CodeMirror.fromTextArea(document.getElementById("jwt"), {
            mode: "javascript",
            lineNumbers: false,
            lineWrapping: true
        });
        jwt.focus();

        var header = CodeMirror.fromTextArea(document.getElementById("header"), {
            mode: "javascript",
            lineNumbers: false,
            lineWrapping: true
        });
        var claims = CodeMirror.fromTextArea(document.getElementById("claims"), {
            mode: "javascript",
            lineNumbers: false,
            lineWrapping: true
        });
        // Initialize tooltip
        $('[data-toggle="tooltip"]').tooltip();

        // Add click event to the Copy button
        $("#copyButton").click(function () {
            var input = $("#pwdField")[0];
            input.focus();
            input.select();

            navigator.clipboard
                .writeText(input.value)
                .then(() => {
                    // Show tooltip for a brief period
                    $(this).text("Copied!");
                    $(this).tooltip("show");

                    // Hide tooltip after 1.5 seconds (adjust as needed)
                    setTimeout(function () {
                        $("#copyButton").tooltip("hide");
                        $("#copyButton").text("Copy Password!");
                    }, 1500);
                })
                .catch(() => {
                    alert("something went wrong");
                });


        });
    });
</script>